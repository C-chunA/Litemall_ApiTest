
# Litemall API è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Python + Pytest æ„å»ºçš„ API è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œæ—¨åœ¨å¯¹ Litemall ç”µå•†å¹³å°çš„åç«¯ API è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚


## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **åˆ†å±‚æ¶æ„è®¾è®¡**ï¼šæ¸…æ™°çš„ç›®å½•ç»“æ„ï¼Œå°†æµ‹è¯•ç”¨ä¾‹ã€ä¸šåŠ¡é€»è¾‘ã€API å°è£…ã€å·¥å…·ç±»å’Œæµ‹è¯•æ•°æ®åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤ã€‚
- **å…³é”®å­—é©±åŠ¨**ï¼šä¸šåŠ¡é€»è¾‘å°è£…åœ¨ `keywords/keywords.py` ä¸­ï¼Œä½¿æµ‹è¯•ç”¨ä¾‹æ›´æ˜“è¯»ã€è´´è¿‘ä¸šåŠ¡åœºæ™¯ã€‚
- **æ•°æ®é©±åŠ¨**ï¼šé€šè¿‡ YAML æ–‡ä»¶ï¼ˆ`data/` ç›®å½•ï¼‰ç®¡ç†æµ‹è¯•æ•°æ®ï¼Œç»“åˆ `utils/data_loader.py` å®ç°å‚æ•°åŒ–æµ‹è¯•ã€‚
- **å¼ºå¤§çš„ Fixture ç®¡ç†**ï¼šé€šè¿‡ `tests/conftest.py` å¤„ç†æµ‹è¯•ç¯å¢ƒå‡†å¤‡ä¸æ¸…ç†ï¼ˆå¦‚ç™»å½•çŠ¶æ€ç»´æŒã€æµ‹è¯•æ•°æ®é¢„ç½®ï¼‰ã€‚
- **è¯¦ç»†æ—¥å¿—ç³»ç»Ÿ**ï¼šæ—¥å¿—åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’ŒæŒ‰å¤©å½’æ¡£çš„æ–‡ä»¶ï¼ˆ`logs/YYYY-MM-DD.log`ï¼‰ï¼Œè‡ªåŠ¨å…³è”æµ‹è¯•ç”¨ä¾‹ä¸Šä¸‹æ–‡ã€‚
- **å¯è§†åŒ–æµ‹è¯•æŠ¥å‘Š**ï¼šé›†æˆ Allure æ¡†æ¶ï¼Œç”ŸæˆåŒ…å«æ­¥éª¤ã€æˆªå›¾ã€æ—¥å¿—çš„è¯¦ç»†æŠ¥å‘Šã€‚
- **çµæ´»çš„æµ‹è¯•æ‰§è¡Œ**ï¼šæ”¯æŒé€šè¿‡ pytest æ ‡è®°ï¼ˆ`pytest.ini` å®šä¹‰ï¼‰ç­›é€‰ç‰¹å®šæ¨¡å—æˆ–ä¼˜å…ˆçº§çš„æµ‹è¯•ç”¨ä¾‹ã€‚


## ğŸ“ é¡¹ç›®ç»“æ„

```
Litemall_ApiTest/
â”œâ”€â”€ api/                  # API æ¥å£å°è£…å±‚ï¼ˆè°ƒåº¦å™¨ï¼‰
â”‚   â””â”€â”€ api_endpoints.py  # ç»Ÿä¸€ç®¡ç†æ¥å£ URLã€æ–¹æ³•ç­‰é…ç½®
â”œâ”€â”€ data/                 # æµ‹è¯•æ•°æ®ï¼ˆYAML æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ add_shoppingcart.yaml  # è´­ç‰©è½¦ç›¸å…³æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ test_data.yaml          # ç™»å½•ç­‰åŸºç¡€æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ ...
â”œâ”€â”€ keywords/             # ä¸šåŠ¡å…³é”®å­—å±‚ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
â”‚   â””â”€â”€ keywords.py       # å°è£…æ¥å£è°ƒç”¨çš„ä¸šåŠ¡æ–¹æ³•ï¼ˆå¦‚ç™»å½•ã€ä¸‹å•ï¼‰
â”œâ”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶å­˜å‚¨ç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ tests/                # æµ‹è¯•è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ conftest.py       # Pytest Fixtures é…ç½®ï¼ˆç¯å¢ƒå‡†å¤‡ä¸æ¸…ç†ï¼‰
â”‚   â”œâ”€â”€ test_api/         # å•æ¥å£æµ‹è¯•ç”¨ä¾‹
â”‚   â”‚   â”œâ”€â”€ test_add_shopptcart.py  # è´­ç‰©è½¦æ·»åŠ æµ‹è¯•
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ multiple_api/     # å¤šæ¥å£æµç¨‹æµ‹è¯•ç”¨ä¾‹
â”‚       â””â”€â”€ test_cart_flow.py  # è´­ç‰©è½¦å®Œæ•´æµç¨‹æµ‹è¯•
â”œâ”€â”€ utils/                # é€šç”¨å·¥å…·ç±»
â”‚   â”œâ”€â”€ assertion_handler.py  # é€šç”¨æ–­è¨€æ–¹æ³•
â”‚   â”œâ”€â”€ data_loader.py    # YAML æ•°æ®åŠ è½½å™¨
â”‚   â”œâ”€â”€ logger.py         # æ—¥å¿—é€‚é…å™¨ï¼ˆæ·»åŠ æµ‹è¯•ç”¨ä¾‹ä¸Šä¸‹æ–‡ï¼‰
â”‚   â””â”€â”€ request_handler.py # åº•å±‚ HTTP è¯·æ±‚å‘é€
â”œâ”€â”€ .gitignore            # Git å¿½ç•¥æ–‡ä»¶é…ç½®
â”œâ”€â”€ pytest.ini            # Pytest é…ç½®æ–‡ä»¶ï¼ˆåŸºç¡€ URLã€æ ‡è®°ã€æ—¥å¿—ç­‰ï¼‰
â””â”€â”€ requirements.txt      # é¡¹ç›®ä¾èµ–åº“æ¸…å•
```


## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

- ç¡®ä¿å·²å®‰è£… Python 3.x
- å…‹éš†æœ¬é¡¹ç›®åˆ°æœ¬åœ°
- åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `requirements.txt`ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š
  ```
  pytest
  requests
  PyYAML
  allure-pytest
  pytest-html
  pytest-base-url
  pytest-metadata
  ```
- å®‰è£…ä¾èµ–åº“ï¼š
  ```bash
  pip install -r requirements.txt
  ```
- å®‰è£… Allure å‘½ä»¤è¡Œå·¥å…·ï¼ˆç”¨äºç”ŸæˆæŠ¥å‘Šï¼‰ï¼Œå‚è€ƒ [Allure å®˜æ–¹æ–‡æ¡£](https://docs.qameta.io/allure/)


### 2. é…ç½®

æ ¸å¿ƒé…ç½®ä½äº `pytest.ini`ï¼š
- `base_url`ï¼šè¢«æµ‹ API çš„åŸºç¡€ URLï¼ˆå¦‚ `http://112.126.74.187`ï¼‰
- `markers`ï¼šè‡ªå®šä¹‰æµ‹è¯•æ ‡è®°ï¼ˆå¦‚ `shopping_cart`ã€`login`ï¼‰ï¼Œç”¨äºç­›é€‰æµ‹è¯•ç”¨ä¾‹
- æ—¥å¿—é…ç½®ï¼šæ§åˆ¶å°æ—¥å¿—æ ¼å¼ã€çº§åˆ«ç­‰ï¼ˆæ–‡ä»¶æ—¥å¿—ç”± `tests/conftest.py` ç®¡ç†ï¼‰


### 3. è¿è¡Œæµ‹è¯•

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

- è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼š
  ```bash
  pytest
  ```

- æ˜¾ç¤ºè¯¦ç»†è¾“å‡ºï¼š
  ```bash
  pytest -v
  ```

- è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•ï¼ˆå¦‚è´­ç‰©è½¦æ¨¡å—ï¼‰ï¼š
  ```bash
  pytest -m shopping_cart
  ```

- è¿è¡ŒæŒ‡å®šæ–‡ä»¶ï¼š
  ```bash
  pytest tests/test_api/test_add_shopptcart.py
  ```

- è¿è¡ŒæŒ‡å®šæ–‡ä»¶ä¸­çš„ç±»ï¼š
  ```bash
  pytest tests/test_api/test_add_shopptcart.py::TestShoppingCart
  ```

- è¿è¡ŒæŒ‡å®šç±»ä¸­çš„ç‰¹å®šå‡½æ•°ï¼ˆå‚æ•°åŒ–åœºæ™¯ï¼‰ï¼š
  ```bash
  pytest tests/test_api/test_add_shopptcart.py::TestShoppingCart::test_add_to_cart_scenarios[add_success]
  ```


### 4. ç”Ÿæˆå¹¶æŸ¥çœ‹ Allure æŠ¥å‘Š

- è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆ Allure ç»“æœï¼š
  ```bash
  pytest --alluredir=./allure-results
  ```

- å¯åŠ¨ Allure æœåŠ¡æŸ¥çœ‹æŠ¥å‘Šï¼š
  ```bash
  allure serve ./allure-results
  ```

Allure ä¼šåœ¨é»˜è®¤æµè§ˆå™¨ä¸­æ‰“å¼€æœ¬åœ°æœåŠ¡ï¼Œå±•ç¤ºåŒ…å«æµ‹è¯•æ­¥éª¤ã€æ—¥å¿—ã€æ–­è¨€ç»“æœçš„å¯è§†åŒ–æŠ¥å‘Šã€‚


## ğŸ“ å¦‚ä½•æ·»åŠ æ–°çš„æµ‹è¯•

1. **å®šä¹‰æ¥å£**ï¼šåœ¨ `data/` ç›®å½•çš„ YAML æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ `interfaces` èŠ‚ç‚¹æ·»åŠ æ¥å£çš„ URLã€æ–¹æ³•ã€è¯·æ±‚å¤´ï¼š
   ```yaml
   interfaces:
     add_address:
       url: /wx/address/save
       method: POST
       headers:
         Content-Type: application/json
   ```

2. **å‡†å¤‡æµ‹è¯•æ•°æ®**ï¼šåœ¨åŒä¸€ YAML æ–‡ä»¶ä¸­ï¼š
   - é€šè¿‡ `test_cases` èŠ‚ç‚¹å®šä¹‰å‚æ•°åŒ–è¾“å…¥ï¼ˆå¦‚ä¸åŒåœºæ™¯çš„è¯·æ±‚å‚æ•°ï¼‰
   - é€šè¿‡ `expected` èŠ‚ç‚¹å®šä¹‰å¯¹åº”é¢„æœŸç»“æœï¼š
   ```yaml
   test_cases:
     add_success:
       name: "æµ‹è¯•ç”¨æˆ·"
       tel: "13800138000"
   expected:
     add_success:
       errno: 0
       errmsg: æˆåŠŸ
   ```

3. **å°è£…ä¸šåŠ¡å…³é”®å­—**ï¼šåœ¨ `keywords/keywords.py` ä¸­æ·»åŠ æ–¹æ³•ï¼Œå°è£…æ¥å£è°ƒç”¨é€»è¾‘ï¼ˆå«æ—¥å¿—è®°å½•ï¼‰ï¼š
   ```python
   def add_address(self, name, tel, ...):
       self.logger.info("å¼€å§‹æ–°å¢åœ°å€")
       # æ„é€ è¯·æ±‚æ•°æ®ã€è°ƒç”¨æ¥å£ã€è¿”å›å“åº”
   ```

4. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**ï¼šåœ¨ `tests/test_api/` æˆ– `tests/multiple_api/` ç›®å½•ä¸‹åˆ›å»º `test_*.py` æ–‡ä»¶ï¼š
   - **å•æ¥å£å‚æ•°åŒ–æµ‹è¯•**ï¼šå‚è€ƒ `test_add_shopptcart.py`ï¼Œä½¿ç”¨ `@pytest.mark.parametrize` å’Œ `load_yaml_test_data`
   - **ä¾èµ– Fixture çš„æµ‹è¯•**ï¼šå‚è€ƒ `test_update_shoppingcart.py`ï¼Œåœ¨å‡½æ•°å‚æ•°ä¸­å¼•ç”¨ Fixtureï¼ˆå¦‚ `logged_in_keywords`ï¼‰
   - **æµç¨‹æµ‹è¯•**ï¼šå‚è€ƒ `test_cart_flow.py`ï¼ŒæŒ‰é¡ºåºè°ƒç”¨å¤šä¸ªå…³é”®å­—å®ç°ä¸šåŠ¡æµç¨‹

5. **æ·»åŠ æ ‡è®°ï¼ˆå¯é€‰ï¼‰**ï¼šåœ¨æµ‹è¯•ç±»/å‡½æ•°ä¸Šæ·»åŠ  `@pytest.mark.<æ ‡è®°å>`ï¼Œå¹¶åœ¨ `pytest.ini` ä¸­æ³¨å†Œæ ‡è®°ã€‚


## ğŸ¤ è´¡çŒ®

æ¬¢è¿é€šè¿‡ Issue åé¦ˆé—®é¢˜æˆ–æäº¤ Pull Request æ”¹è¿›æ¡†æ¶ã€‚
